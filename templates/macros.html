{% macro render_component(component_id) %}
<div id="{{ component_id }}"></div>
<script src="js/{{ component_id }}.js" defer></script>
{% endmacro %}


{% macro navbar() %}
<nav
    class="top-0 left-0 right-0 bg-sidebar text-sidebar-foreground h-18 grow-0 flex flex-col justify-center relative z-20">
    <div class="w-full mx-auto">
        <div class="flex justify-between items-center h-12 pl-3 pr-6">
            <div class="flex items-center space-x-2">
                <a href="/workspace" class="-m-1.5 p-1.5">
                    <span class="sr-only">OpenBacklog</span>
                    <span class="tracking-wide text-sidebar-foreground/80">OpenBacklog</span>
                </a>
            </div>

            <div class="flex gap-x-2">

                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-2">
                    <a href="/workspace/initiatives"
                        class="rounded flex items-center justify-center gap-x-1.5 px-2.5 py-1.5 text-sidebar-foreground/80 hover:text-sidebar-foreground transition-colors"
                        title="Initiatives">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M16 11V5h4c1.1 0 2 .9 2 2v4h-6zm4 8c1.1 0 2-.9 2-2v-4h-6v6h4zM14 5v14H4c-1.1 0-2-.9-2-2V7c0-1.1.9-2 2-2h10zm-4.5 7c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5.67 1.5 1.5 1.5 1.5-.67 1.5-1.5z"></path></svg>
                        <span>Initiatives</span>
                    </a>
                    <a href="/workspace/roadmap"
                        class="rounded flex items-center justify-center gap-x-1.5 px-2.5 py-1.5 text-sidebar-foreground/80 hover:text-sidebar-foreground transition-colors"
                        title="Roadmap">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="m20.5 3-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"></path></svg>
                        <span>Roadmap</span>
                    </a>
                    <a href="/workspace/strategy-flow"
                        class="rounded flex items-center justify-center gap-x-1.5 px-2.5 py-1.5 text-sidebar-foreground/80 hover:text-sidebar-foreground transition-colors"
                        title="Strategy">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M15.25 12h-0.25v-3.25c0-0.965-0.785-1.75-1.75-1.75h-4.25v-2h0.25c0.412 0 0.75-0.338 0.75-0.75v-2.5c0-0.413-0.338-0.75-0.75-0.75h-2.5c-0.412 0-0.75 0.337-0.75 0.75v2.5c0 0.412 0.338 0.75 0.75 0.75h0.25v2h-4.25c-0.965 0-1.75 0.785-1.75 1.75v3.25h-0.25c-0.412 0-0.75 0.338-0.75 0.75v2.5c0 0.412 0.338 0.75 0.75 0.75h2.5c0.413 0 0.75-0.338 0.75-0.75v-2.5c0-0.412-0.337-0.75-0.75-0.75h-0.25v-3h4v3h-0.25c-0.412 0-0.75 0.338-0.75 0.75v2.5c0 0.412 0.338 0.75 0.75 0.75h2.5c0.412 0 0.75-0.338 0.75-0.75v-2.5c0-0.412-0.338-0.75-0.75-0.75h-0.25v-3h4v3h-0.25c-0.412 0-0.75 0.338-0.75 0.75v2.5c0 0.412 0.338 0.75 0.75 0.75h2.5c0.412 0 0.75-0.338 0.75-0.75v-2.5c0-0.412-0.338-0.75-0.75-0.75zM3 15h-2v-2h2v2zM9 15h-2v-2h2v2zM7 4v-2h2v2h-2zM15 15h-2v-2h2v2z"></path></svg>
                        <span>Strategy</span>
                    </a>
                    <a href="/workspace/story-bible"
                        class="rounded flex items-center justify-center gap-x-1.5 px-2.5 py-1.5 text-sidebar-foreground/80 hover:text-sidebar-foreground transition-colors"
                        title="Story Bible">
                        <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L240 221.3l57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"></path></svg>
                        <span>Story Bible</span>
                    </a>
                </div>

                <!-- Theme Toggle -->
                <button onclick="toggleTheme()"
                    class="text-sidebar-foreground/80 hover:text-sidebar-foreground rounded-md p-1.5 transition-colors"
                    title="Toggle theme">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                    </svg>
                </button>

                <!-- Support -->
                <a href="{{ docs_site_url }}/support"
                    class="text-sidebar-foreground/80 hover:text-sidebar-foreground rounded-md p-1.5 transition-colors"
                    title="Support">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                        stroke="currentColor" class="size-5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.712 4.33a9.027 9.027 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.014 9.014 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.014 9.014 0 0 1 0 9.424m-4.138-5.976a3.736 3.736 0 0 0-.88-1.388 3.737 3.737 0 0 0-1.388-.88m2.268 2.268a3.765 3.765 0 0 1 0 2.528m-2.268-4.796a3.765 3.765 0 0 0-2.528 0m4.796 4.796c-.181.506-.475.982-.88 1.388a3.736 3.736 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9.027 9.027 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.014 9.014 0 0 1-9.424 0m5.976-4.138a3.765 3.765 0 0 1-2.528 0m0 0a3.736 3.736 0 0 1-1.388-.88 3.737 3.737 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9.024 9.024 0 0 1-1.652-1.306 9.027 9.027 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.014 9.014 0 0 1 0-9.424m4.138 5.976a3.765 3.765 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.736 3.736 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9.024 9.024 0 0 0-1.652 1.306A9.025 9.025 0 0 0 4.33 7.288" />
                    </svg>
                </a>

                <!-- Account -->
                <a href="/account"
                    class="text-sidebar-foreground/80 hover:text-sidebar-foreground rounded-md p-1.5 transition-colors"
                    title="Account settings">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                        stroke="currentColor" class="size-5">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    </svg>
                </a>
            </div>
        </div>
    </div>
</nav>

<script>
    function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        html.classList.remove('dark', 'light');
        html.classList.add(newTheme);

        // Save preference
        localStorage.setItem('theme', newTheme);
    }

    // Initialize theme on page load
    document.addEventListener('DOMContentLoaded', function () {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.classList.add(savedTheme);
    });
</script>
{% endmacro %}

{% macro login_button_script() %}
<script async>
    // Check for error query parameter on page load
    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');

        if (error === 'signups_disabled') {
            showSignupDisabledMessage("We're not currently accepting new signups. Please check back later.");
            // Clean up URL by removing the error parameter
            const url = new URL(window.location);
            url.searchParams.delete('error');
            window.history.replaceState({}, document.title, url.toString());
        }
    });
    async function getLoginUrl() {
        try {
            const res = await fetch('/auth/login-url', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            });

            if (!res.ok) {
                console.error(`Error fetching login URL: ${res.status} ${res.statusText}`);
                return null;
            }

            const data = await res.json();
            return data.authorization_url;
        } catch (err) {
            console.error('Error fetching login URL:', err);
            return null;
        }
    }

    // Attach event listener to login buttons
    document.querySelectorAll('.login-btn-trigger').forEach(button => {
        button.addEventListener('click', async (e) => {
            e.preventDefault();
            const loginBtn = e.currentTarget;
            loginBtn.disabled = true;
            loginBtn.classList.add('cursor-progress');

            try {
                const result = await getLoginUrl();

                if (result && typeof result === 'string') {
                    // Normal login URL received
                    console.log('Redirecting to:', result);
                    window.location.href = result;
                } else {
                    console.error('Failed to get login URL');
                    loginBtn.disabled = false;
                    loginBtn.classList.remove('cursor-progress');
                }
            } catch (err) {
                console.error('Login error:', err);
                loginBtn.disabled = false;
                loginBtn.classList.remove('cursor-progress');
            }
        });
    });

    // Function to show signup disabled message
    function showSignupDisabledMessage(message) {
        // Remove any existing message
        const existingMessage = document.querySelector('.signup-disabled-message');
        if (existingMessage) {
            existingMessage.remove();
        }

        // Create message element
        const messageDiv = document.createElement('div');
        messageDiv.className = 'signup-disabled-message bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mt-4 text-sm';
        messageDiv.textContent = message;

        // Insert message after the buttons container
        const buttonsContainer = document.querySelector('.space-y-4');
        if (buttonsContainer) {
            buttonsContainer.parentNode.insertBefore(messageDiv, buttonsContainer.nextSibling);
        }
    }
</script>
{% endmacro %}